<Window xmlns="https://github.com/avaloniaui"
        xmlns:mrrr="using:System.Collections.Generic"
		xmlns:scg="clr-namespace:System.Collections;assembly=mscorlib"
		xmlns:system="using:System"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:eSearch.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:local="clr-namespace:eSearch.ViewModels;assembly=eSearch"
		xmlns:localView="clr-namespace:eSearch.Views;assembly=eSearch"
		xmlns:converters="clr-namespace:eSearch.Converters;assembly=eSearch"
		xmlns:llmctrls="clr-namespace:eSearch.Views.LLMConversations;assembly=eSearch"
        xmlns:localViews="using:eSearch.Views"
		xmlns:statusctrl="clr-namespace:eSearch.Views.StatusUI;assembly=eSearch"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
        x:Class="eSearch.Views.MainWindow"
		Icon="{Binding ApplicationIcon}"
        Title="{Binding S[eSearch]}"
		MinWidth="400"
		MinHeight="400"
		WindowStartupLocation="CenterScreen"
		ExtendClientAreaToDecorationsHint="True"
		>
	<Window.Resources>
		<converters:BoolToStringConverter x:Key="BoolToStringConverter"/>
	</Window.Resources>
	<Window.Styles>
		<!-- TransparencyLevelHint="AcrylicBlur" -->
		<!-- Background="Transparent" -->
		<Style Selector="Button.ProductTag">
			<Setter Property="Background" Value="{Binding ApplicationBrandPrimaryColor}"/>
			<Setter Property="Foreground" Value="{Binding ApplicationBrandTextColor}"/>
			<Setter Property="CornerRadius" Value="0"/>
		</Style>
		
		<Style Selector="Window[WindowState=Maximized]">
			<Setter Property="Padding" Value="8" />
		</Style>
	</Window.Styles>
	<Design.DataContext>
		<!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
		<vm:MainWindowViewModel/>
	</Design.DataContext>
	<Grid> <!-- The grid control is used to layer toasts over the main UI -->
		<DockPanel x:Name="MainUIDockPanel" Background="Transparent"> <!-- The main UI -->
			<DockPanel DockPanel.Dock="Top" x:Name="MenuOnly">
				<StackPanel DockPanel.Dock="Left" Orientation="Horizontal" Margin="10,5" Spacing="5">
					<Image Source="{Binding ProductIcon}" Width="20" Height="20"/>
					<Menu x:Name="MainMenuMini" IsVisible="False">
						<MenuItem Width="50" x:Name="MainMenuHamburger">
							<MenuItem.Header>
								<Image Source="{Binding I[icons8-menu-32.png]}"
									Width="16"
									Height="16"
									/>
							</MenuItem.Header>
							<MenuItem>
								<MenuItem.Template>
									<ControlTemplate>
										<localView:MainMenuItems Classes="HamburgerMenu">
											
										</localView:MainMenuItems>	
									</ControlTemplate>
								</MenuItem.Template>
							</MenuItem>
						</MenuItem>
					</Menu>

					
					<localView:MainMenuItems x:Name="MainMenu">
						
					</localView:MainMenuItems>
					<!--
					<Menu x:Name="MainMenu" MinWidth="340" Height="35" HorizontalAlignment="Left" TabIndex="0" ItemsSource="{StaticResource MainMenuItems}">
						
					</Menu>
					-->
				</StackPanel>
				<Button 
					DockPanel.Dock="Right"  Margin="0,0,150,0" Padding="15,5"
					Classes="ProductTag"
					HorizontalAlignment="Right" VerticalAlignment="Top"
					Command="{Binding HelpAboutApplication}"
					Content="{Binding ProductTagText}"
					TabIndex="1"
				/>
			</DockPanel>
			<Border 
				Classes="MainPanel" 
				DockPanel.Dock="Bottom" 
				x:Name="UIOnly"
				Margin="5"
				>
				<DockPanel x:Name="SearchAndSidebar">
					<Panel x:Name="Sidebar" Width="200" VerticalAlignment="Stretch" IsVisible="{Binding ShowWordWheel}">
						<DockPanel>

							<ItemsControl DockPanel.Dock="Bottom" ItemsSource="{Binding StatusMessages}">
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<statusctrl:StatusControl/>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
							<localView:WordWheelControl DataContext="{Binding}"
														Width="200"
														x:Name="WordWheelControl"/>
						
						</DockPanel>
					</Panel>
					<DockPanel >
						<localView:SearchControl x:Name="MWSearchControl" DataContext="{Binding}" DockPanel.Dock="Top"></localView:SearchControl>
						<Panel
							DockPanel.Dock="Top"
							x:Name="RegistrationPromptPanel"
							Background="BlanchedAlmond"
							IsVisible="False"
							>
							<DockPanel Margin="3">
								<Button
									DockPanel.Dock="Right"
									Content="{Binding S[Register...]}"
									Command="{Binding ClickRegister}"
									Padding="15,5"
								/>
								<Label Margin="0,3">Lite - Limited to 10 results.</Label>
							</DockPanel>
						</Panel>
						<DockPanel>

							<Grid x:Name="ResultsAndDocumentView" RowDefinitions="*, 6, *" ColumnDefinitions="*">
								<DockPanel x:Name="ResultsView" Grid.Row="0" IsVisible="{Binding !Session.Query.UseAISearch}">
									<Border DockPanel.Dock="Right"
											BorderThickness="1 0 0 0"
											BorderBrush="{DynamicResource SystemChromeHighColor}">
										<StackPanel Width="30">
											<Button Width="30"
													Height="30"
													x:Name="ResultsSettingsButton"
													Classes="TransparentBtn"
													IsEnabled="{Binding SelectedIndex, Converter={x:Static ObjectConverters.IsNotNull}}"
													Padding="0"
													ToolTip.Tip="{Binding S[Results~Settings...]}"
													>
												<Image Source="{Binding I[icons8-settings-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
										
											<Button x:Name="ResultsCopyButton"
													Width="30"
													Height="30"
													Classes="TransparentBtn"
													Command="{Binding ClickCopyResults}"
													ToolTip.Tip="{Binding S[Copy~Results...]}"
													IsEnabled="False"
													>
												<Image Source="{Binding I[icons8-copy-16.png]}"
													   Width="16"
													   Height="16"
												   
													   />
											</Button>
										</StackPanel>
									</Border>

									<Grid x:Name="SearchResultsGridWrapper">
										<TreeDataGrid
										x:Name="ResultsGrid2"
										CanUserResizeColumns="True"
										CanUserSortColumns="True"
									
										>
											<TreeDataGrid.Styles>
												<Style Selector="TreeDataGridRow">
													<Setter Property="MinHeight" Value="40" />
												</Style>
												<Style Selector="TreeDataGridCell">
													<Setter Property="Padding" Value="5"/>
												</Style>
											</TreeDataGrid.Styles>
										</TreeDataGrid>
									</Grid>
								</DockPanel>
								<GridSplitter 
									x:Name="ResultsDocumentSplitter" 
									Grid.Row="1" 
									Background="{DynamicResource SystemChromeHighColor}" 
									ResizeDirection="Rows"
									IsVisible="{Binding !IsGridSplitterHidden}"/>

								<DockPanel x:Name="DocumentView" Grid.Row="2">

									<Border DockPanel.Dock="Right"
											BorderThickness="1 0 0 0"
											BorderBrush="{DynamicResource SystemChromeHighColor}"
											>
										<StackPanel Width="30">
											<Button Width="30"
													Height="30"
													x:Name="DocumentSettingsButton"
													Classes="TransparentBtn"
													ToolTip.Tip="{Binding S[Viewer~Settings...]}"
													Command="{Binding ClickDocumentSettings}"
													>
												<Image Source="{Binding I[icons8-settings-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
											<Button x:Name="DocumentCopyButton"
													Width="30"
													Height="30"
													Classes="TransparentBtn"
													IsVisible="{Binding !Session.Query.UseAISearch}"
													IsEnabled="{Binding SelectedResult, Converter={x:Static ObjectConverters.IsNotNull}}"
													ToolTip.Tip="{Binding S[Copy~Document...]}"
													>
												<Image Source="{Binding I[icons8-copy-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
											<Button x:Name="ConversationCopyButton"
													Width="30" Height="30"
													Classes="TransparentBtn"
													IsVisible="{Binding Session.Query.UseAISearch}"
													ToolTip.Tip="{Binding S[Copy~Conversation]}">
												<Image Source="{Binding I[icons8-copy-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
											<ToggleButton x:Name="DocumentMetadataButton"
													Width="30"
													Height="30"
													Classes="TransparentBtn"
													ToolTip.Tip="{Binding S[Document~Metadata]}"
													IsVisible="{Binding !Session.Query.UseAISearch}"
													IsEnabled="{Binding SelectedResult, Converter={x:Static ObjectConverters.IsNotNull}}"
													IsChecked="{Binding ShowMetadataPanel}">
												<Image Source="{Binding I[icons8-information-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</ToggleButton>
											<ToggleButton x:Name="DocumentViewLocationButton"
													Width="30"
													Height="30"
													Classes="TransparentBtn"
													ToolTip.Tip="{Binding DocumentLocationButtonToolTip}"
													IsEnabled="{Binding SelectedResult, Converter={x:Static ObjectConverters.IsNotNull}}"
													IsChecked="{Binding ShowDocumentLocation}"
													>
												<ToggleButton.IsVisible>
													<MultiBinding Converter="{x:Static BoolConverters.And}">
														<Binding Path="IsDocumentLocationAvailable"/>
														<Binding Path="!Session.Query.UseAISearch"/>
													</MultiBinding>
												</ToggleButton.IsVisible>
												<Image Source="{Binding I[icons8-location-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</ToggleButton>
											<Button x:Name="DocumentViewInFolderButton"
													Width="30"
													Height="30"
													Classes="TransparentBtn"
													ToolTip.Tip="{Binding S[View~in~folder]}"
													Command="{Binding ClickDocumentViewInFolder}"
													IsEnabled="{Binding SelectedResult, Converter={x:Static ObjectConverters.IsNotNull}}"
													IsVisible="{Binding !Session.Query.UseAISearch}"
													>
												<Image Source="{Binding I[icons8-folder-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
										</StackPanel>
									</Border>
									<Border DockPanel.Dock="Top" BorderThickness="0 0 0 1" BorderBrush="LightGray" IsVisible="{Binding ShowHitNavigation}">
										<StackPanel Height="30" Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
											<Button x:Name="BtnPrevHit"
													Width="30"
													Height="30"
													Background="Transparent"
													ToolTip.Tip="{Binding S[Previous~Hit]}"
													Command="{Binding PrevHit}"
													>
												<Image Source="{Binding I[icons8-sort-left-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
											<NumericUpDown x:Name="InputSelectedHit"
														   ShowButtonSpinner="False"
														   Value="{Binding CurrentDocSelectedHit}"
														   Maximum="{Binding CurrentDocHitCount}"
														   Minimum="1"
														   BorderThickness="0"
														   Background="Transparent"
														   >

											</NumericUpDown>
											<Label>/</Label>
											<Label Content="{Binding CurrentDocHitCount}"></Label>
											<Button x:Name="BtnNextHit"
													Width="30"
													Height="30"
													Background="Transparent"
													ToolTip.Tip="{Binding S[Next~Hit]}"
													Command="{Binding NextHit}"
													>
												<Image Source="{Binding I[icons8-sort-right-16.png]}"
													   Width="16"
													   Height="16"
													   />
											</Button>
										</StackPanel>
									</Border>
									<Panel VerticalAlignment="Stretch" HorizontalAlignment="Stretch" IsVisible="{Binding ShowMetadataPanel}">
										<DataGrid x:Name="MetadataDataGrid" Name="MetadataDataGrid" IsReadOnly="True"  Margin="0" Padding="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
											<DataGrid.Columns>
												<DataGridTextColumn Header="{Binding S[Key]}"  Binding="{Binding Key}"/>
												<DataGridTextColumn Header="{Binding S[Value]}" Binding="{Binding Value}" />
											</DataGrid.Columns>
										</DataGrid>
									</Panel>
									<Grid>
										<Panel IsVisible="{Binding !Session.Query.UseAISearch}">
											<localView:HtmlDocumentControl x:Name="DocumentViewer" IsVisible="{Binding !ShowMetadataPanel}" />
										</Panel>
										<Panel IsVisible="{Binding Session.Query.UseAISearch}">
											<llmctrls:LLMConversationControl
													x:Name="llmConversationCtrl"
											DataContext="{Binding CurrentLLMConversation}"/>
										</Panel>
									</Grid>
								</DockPanel>
							</Grid>

						</DockPanel>
					</DockPanel>
				</DockPanel>

			</Border>
		</DockPanel>
		<StackPanel Width="200" VerticalAlignment="Bottom" HorizontalAlignment="Left" Classes="MainPanel">
			<Border 
				BorderThickness="1 1 1 1"
				CornerRadius="10"
				Margin="5"
				Padding="5"
				BorderBrush="{DynamicResource SystemChromeMediumColor}"
				Background="{DynamicResource SystemRegionColor}"
			>
				<Border.IsVisible>
					<MultiBinding Converter="{x:Static BoolConverters.And}">
						<Binding Path="!ShowWordWheel"/>
						<Binding Path="!!StatusMessages.Count"/>
					</MultiBinding>
				</Border.IsVisible>
				<ItemsControl DockPanel.Dock="Bottom" ItemsSource="{Binding StatusMessages}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<statusctrl:StatusControl/>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</Border>
		</StackPanel>
	</Grid>
</Window>
